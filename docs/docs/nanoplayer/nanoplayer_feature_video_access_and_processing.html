<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Video Access and Processing · nanocosmos Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Video access and processing using `onActiveVideoElementChange`"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Video Access and Processing · nanocosmos Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.nanocosmos.de/"/><meta property="og:description" content="## Video access and processing using `onActiveVideoElementChange`"/><meta property="og:image" content="https://docs.nanocosmos.de/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://docs.nanocosmos.de/img/docusaurus.png"/><link rel="shortcut icon" href="/img/favicon_nano.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@latest/dist/cdn/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-552140-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/copy-button.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/copy-button.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/nanocosmos_header_logo.png" alt="nanocosmos Documentation"/><h2 class="headerTitleWithLogo">nanocosmos Documentation</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/cloud/cloud_overview" target="_self">nanoStream Cloud</a></li><li class="siteNavGroupActive"><a href="/docs/nanoplayer/nanoplayer_introduction" target="_self">H5Live Player</a></li><li class=""><a href="/docs/webrtc/nanostream_webrtc_introduction" target="_self">nanoStream Webcaster</a></li><li class=""><a href="/docs/nanomeet/introduction" target="_self">nanoMeet</a></li><li class=""><a href="/docs/nanostream/nanostream" target="_self">nanoStream Apps and SDKs</a></li><li class=""><a href="/docs/samples/samples" target="_self">Samples</a></li><li class=""><a href="/docs/faq/faq_streaming" target="_self">FAQ</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Features</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">H5Live Player</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_introduction">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_getting_started">Getting started</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_supported_browsers">Supported Browsers</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_player_metrics">Player Metrics</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_iframe">iframe Embeds</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_autoplay">Autoplay</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_latency_control_modes">Latency control modes</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_stream_group_configuration">Stream group configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_token_security">Secure playback with H5Live</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_stream_switching">Stream switching and ABR</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_fullscreen_api">Fullscreen API</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_customization">UI and customization</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_reconnect_timeouts">Reconnect and Timeouts</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_media_error_recovery">Media Error Recovery</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_source_defaults">Source defaults</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/nanoplayer/nanoplayer_feature_video_access_and_processing">Video Access and Processing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Releases</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_release_latest">Latest</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_release_history">History</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_api">NanoPlayer</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_api_errors">NanoPlayer Error Codes &amp; Handling</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/nanoplayer/nanoplayer_blogposts">Blog</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/nanocosmos/docs/tree/master/docs/nanoplayer/nanoplayer_feature_video_access_and_processing.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Video Access and Processing</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="video-access-and-processing-using-onactivevideoelementchange"></a><a href="#video-access-and-processing-using-onactivevideoelementchange" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Video access and processing using <code>onActiveVideoElementChange</code></h2>
<p>Introduced in <strong>nanoStream H5Live Player Version 4.17.0</strong>, the new <code>onActiveVideoElementChange</code> event is providing access to the active video element. This is enabling video processing use cases such as canvas drawing, snapshoting and in similar occasions when the currently active video element is necessary. The event will be executed when the video element has been activated or changed. Find out more in our API events' section: <a href="https://docs.nanocosmos.de/docs/nanoplayer/nanoplayer_api#onactivevideoelementchange"><code>onActiveVideoElementChange</code></a>.</p>
<blockquote>
<p><strong>Important:</strong>
Video elements should be treated as read-only and not be altered via properties or method calls.</p>
</blockquote>
<p>For functional reasons, on iOS there are 2 video elements. As the event will be fired always on switch/creation etc, there would be an indication which video element is currently displayed.</p>
<p>In case of iOS stream switching, please read more about the <a href="https://docs.nanocosmos.de/docs/nanoplayer/nanoplayer_feature_stream_switching/">stream switch feature</a>.</p>
<blockquote>
<p><strong>Important:</strong>
Canvas drawing might not be supported in all browsers</p>
<ul>
<li>Canvas drawing with Media Source Extensions is not supported in Safari macOS and iPadOS desktop mode (by August 2022)</li>
<li>Experimental support behind the feature flag <code>Experimental MediaSource Inline Painting</code> has been added in Safari 15.4</li>
</ul>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="how-to-use-onactivevideoelementchange-to-take-a-snapshot"></a><a href="#how-to-use-onactivevideoelementchange-to-take-a-snapshot" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to use <code>onActiveVideoElementChange</code> to take a snapshot</h3>
<p>To draw/render image on the canvas or save a snapshot from the video, it is necessary to properly setup the player configuration, declare necessary variables and add functions which will get and then display the image.</p>
<ol>
<li><p>In the html page, add the player and shapshot holder and load the player script.</p>
<pre><code class="hljs css language-javascript">&lt;div&gt;
    &lt;label&gt;Playback&lt;/label&gt;
    &lt;!-- the container element for the player --&gt;
    &lt;div id="playerDiv" style="width: 100%;padding-top: 56.25%;"&gt;&lt;/div&gt;
    &lt;label&gt;Snapshot&lt;/label&gt;
    &lt;!-- the image element for the snapshot --&gt;
    &lt;img id="image"/&gt;
&lt;/div&gt;
&lt;script type="text/javascript" src="nanoplayer.4.min.js"&gt;&lt;/script&gt;
</code></pre></li>
<li><p>Setup the player configuration and declare necessary variables to enable the active video element feature. Due to cross-origin policies for video elements, it is required to set <code>'crossOrigin'</code> to <code>'anonymous'</code> to be able to take a snapshot.</p>
<pre><code class="hljs css language-javascript">    &lt;script type="text/javascript"&gt;
        var playerConfig = { // the basic configuration of the player
            'playback': {
                'autoplay'    : true,
                'automute'    : true,
                'muted'       : false,
                'crossOrigin' :'anonymous'
            },
            'events': {},
            'source': {
                'defaults': {
                    'service': 'bintu'
                },
                'entries': [
                    {
                        'index': 0,
                        'label': 'stream 1',
                        'h5live': {
                            'rtmp': {
                                'streamname': 'xxxx-xxxx' // your streamname
                            }
                        }
                    }
                ]
            },
            'style': {
                'width'                : 'auto',
                'height'               : 'auto'
            }
        };
        var player, activeVideoElement, canvasElement, canvasContext, imgElement, snapshot; // defining the necessary variables
    &lt;/script&gt;
</code></pre></li>
<li><p>Add functions that handle drawing the video on a canvas and convert it to an image.</p>
<pre><code class="hljs css language-javascript">    &lt;script type="text/javascript"&gt;
        function drawImageOnCanvas () { // paint the current video frame on a canvas
            if (activeVideoElement) {
                var w, h;
                w = activeVideoElement.clientWidth;
                h = activeVideoElement.clientHeight;
                canvasElement.width = w;
                canvasElement.height = h;
                canvasContext.drawImage(activeVideoElement, 0, 0, w, h);
            }
        }
        function getImageFromCanvas () { // get a jpeg encoded image as dataURL string from the canvas
            return canvasElement.toDataURL('image/jpeg', 1);
        }
        function showSnapshot (dataURL) { // set the dataURL string as image source
            imgElement.src = dataURL;
        }
        function takeSnapshot (){ // take the snapshot by drawing the video on a canvas, getting the image and display it in a img element
            drawImageOnCanvas();
            snapshot = getImageFromCanvas();
            showSnapshot(snapshot);
        }
    &lt;/script&gt;

</code></pre></li>
<li><p>Create event handlers that connect the player to the snapshot functionality. It is essential to get the active video element reference and invalidate it on destroy. For demonstrative purposes snapshots are taken on play, on pause and when the active video element is changing.</p>
<pre><code class="hljs css language-javascript">    &lt;script type="text/javascript"&gt;
        function onActiveVideoElementChange (event) { // fires if a video element for playback will be activated or changed
            activeVideoElement = event.data.activeVideoElement; // store a reference to the active video element to be able to access it
            takeSnapshot();
        }
        function onPlay (event) { // fires if the playback has been started
            takeSnapshot();
        }
        function onPause (event) { // fires if the playback has been stopped
            takeSnapshot();
        }
        function onDestroy (event) { // fires if the player will be destroyed
            activeVideoElement = null; // remove the reference to the element, the element should not be accessed after destroy
        }
    &lt;/script&gt;
</code></pre></li>
<li><p>Prepare DOM elements and setup the player.</p>
<pre><code class="hljs css language-javascript">    &lt;script type="text/javascript"&gt;
        function prepareElements () { // load necessary DOM elements into variables
            canvasElement = document.createElement('canvas');
            canvasContext = canvasElement.getContext('2d');
            imgElement = document.querySelector('img');
        }
        function preparePlayerConfig () { // add additional needed parameters to the player configuration
            playerConfig.playback.crossOrigin = 'anonymous';
            playerConfig.events.onActiveVideoElementChange = onActiveVideoElementChange;
            playerConfig.events.onPlay = onPlay;
            playerConfig.events.onPause = onPause;
            playerConfig.events.onDestroy = onDestroy;
        }
        function initPlayer () { // instanciate and setup the player
            player = new NanoPlayer('playerDiv');
            player.setup(playerConfig).then(function (_config) {
                console.log('setup ok with playerConfig: ' + JSON.stringify(_config));
            }, function (error) {
                console.log(error);
            });
        }
        document.addEventListener('DOMContentLoaded', function () {
            prepareElements();
            preparePlayerConfig();
            initPlayer();
        });
    &lt;/script&gt;
</code></pre></li>
</ol>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 6/27/2023</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/nanoplayer/nanoplayer_feature_source_defaults"><span class="arrow-prev">← </span><span>Source defaults</span></a><a class="docs-next button" href="/docs/nanoplayer/nanoplayer_release_latest"><span>Latest</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#video-access-and-processing-using-onactivevideoelementchange">Video access and processing using <code>onActiveVideoElementChange</code></a><ul class="toc-headings"><li><a href="#how-to-use-onactivevideoelementchange-to-take-a-snapshot">How to use <code>onActiveVideoElementChange</code> to take a snapshot</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Contact</h5><a href="https://www.nanocosmos.de/">Homepage</a><a href="https://www.nanocosmos.de/contact">Contact</a><a href="https://www.nanocosmos.de/support">Support</a><a href="https://www.nanocosmos.de/terms">Legal Terms</a></div><div><h5>Products</h5><a href="https://www.nanocosmos.de/cloud">Nanostream Cloud with Bintu.Live</a><a href="https://www.nanocosmos.de/h5live">H5Live Low Latency HTML5-Player</a><a href="https://www.nanocosmos.de/webrtc">nanoStream Webcaster</a><a href="https://www.nanocosmos.de/#nanostream">Nanostream Apps and SDK</a></div><div><h5>More</h5><a href="https://www.nanocosmos.de/blog/">Blog</a><a href="https://twitter.com/nanovideo">Twitter</a><a href="https://www.facebook.com/nanocosmos.net/">Facebook</a><a href="https://www.linkedin.com/company/nanocosmos-gmbh">LinkedIn</a><a href="https://github.com/nanocosmos/docs">GitHub</a><a class="github-button" href="https://github.com/nanocosmos/docs" data-icon="octicon-star" data-count-href="/nanocosmos/docs/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://nanocosmos.de/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/footer_logo.png" alt="nanocosmos GmbH" width="170" height="45"/></a><section class="copyright">Copyright © 2023 nanocosmos GmbH - doc version Tue Jun 27 2023 12:15:44 GMT+0000 (Coordinated Universal Time)</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typesense-docsearch.js@latest/dist/cdn/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                inputSelector: '#search_input_react',
                typesenseServerConfig: {"nodes":[{"host":"typesense.nanostream.cloud","port":"443","protocol":"https"}],"apiKey":"VXsRNvH2cHHs5uVOk74gX8jDtWTTVKsV"},
                typesenseCollectionName: "nanocosmos",
                typesenseSearchParams: {"per_page":20},
                debug: true,
              });
              </script></body></html>